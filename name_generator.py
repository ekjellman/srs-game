MONSTERS = """
Aazelion
Aboleth
Aboleth Servitor
Abomination
Abstract Daddy
Acklay
Aculeozzo
Adjule
Afflicted
Aganos
Ahri
Air Soldier
Albert Wesker
Albinoid
Alex Wesker
Alexia Ashford
Alien
Alien Necromorph
Alpha Blogg
Alpha Hopper
Ampulex Compressa Giganteus
Anakaris
Angel
Angelo
Anguirus
Ansem
Ant
Antlion
Antlion Grub
Antlion Guard
Antlion Guardian
Antlion Soldier
Antlion Worker
Anubis
Ao Oni
Aqua Pirate
Aqua Zebesian
Arbok
Archon
Argus
Armadura
Armoured Knight
Ashrah
Asphyxia
Astral Stalker
Asylum Demon
Atropal
Azer
B.O.W.
Bagan
Baker Family
Balhannoth
Bandersnatch
Banshee
Banshrae
Baragon
Baraka
Barnacle
Barroth
Barrowhaunts
Basilisk
Bat
Battlebriar
Bear
Bebop
Beedrill
Beetle
Beholder
Bell Gargoyles
Beowulf the Lightbeast
Berbalang
Berserker Knight
Berserker Lord
Big Boo
Big Mother
Bile Demon
Biolizard
Bishamon
Bit Sniper
Bitores Mendez
Black Arms
Black Assassin
Black Bull
Black Doom
Black Fog
Black Hawk
Black Oak
Black Tiger
Black Volt
Black Warrior
Black Widow
Black Wing
Black Worm
Blastoise
Blaze
Blob
Blogg
Bloggling
Blood Fiend
Bloodfire Ooze
Bloodletter
Bloodmount
Bloodshot
Bloodsucker
Blue Slime
Boar
Bob-omb
Bodak
Body Burner
Boggle
Bokoblin
Bombshell Koopa
Boneclaw
Boo
Boom-Boom
Boomer
Botamon
Botwoon
Bowser
Bowser Jr.
Brain Sucker
Brethren Moon
Broodmother
Brumak
Brute
Brzak
Bubbmon
Bugbear
Bui Kichwa
Bulbasaur
Bulblin
Bulette
Bull rancor
Bullet Bill
Bullsquid
Burner
Butterfree
Cacodemon
Cactuar
Cadaver
Cadaver collector
Cambion
Camel
Cannibal
Carla Radames
Carla Spore
Carnifex
Caro
Carrion Crawler
Caterpie
Centaur
Centaurian
Centurion
Cephalo
Chao
Chaos
Charger
Chargin' Chuck
Chariot
Charizard
Charmander
Charmeleon
Chernabog
Chewy
Chicomon
Chimera
Chip
Chocobo
Choker
Chozo
Chozo Ghost
Chromatic dragon
Chryssalid
Chuul
Clayface
Clefable
Clefairy
Cocomon
Collector Drone
Collector General
Colmillos
Colossus
Corpser
Crawler
Creatures from the Black
Creeper
Creeper and Shambler
Crimson Head
Crocodile
Cyborg Zebesian
Cyclops
Cyril
Cyst
D'Vorah
Daegon
Daemon
Dark Angel
Dark Bat
Dark Drake of the Moon Hills
Dark Eel
Dark Elf
Dark Fright
Dark Gaia
Dark Gaia Phoenix
Dark Koopa
Dark Master
Dark Mistress
Dark One
Dark Samus
Dark Tallon Metroid
Dark one
Darkball
Darkseid
Death Leech
Death knight
Deathclaw
Deborah Harper
Deep Nightmare
Del Lago
Delia
Demon
Demon Spawn
Demon of Song
Derek C. Simmons
Despero
Destrachan
Devil
Devourer
Dhampir
Digger
Digimon
Dinosaur
Direhelm
Displacer beast
Divider
Dodongo
Dog
Doom's Eye
Doomsept
Doppelganger
Dracolich
Dracula
Draegloth
Drag Tentacle
Draghignazzo
Dragon
Dragon King's Army
Dragonborn
Dragonkin
Dragonspawn
Drahmin
Drain Deimos
Drake
Dread Warrior
Drider
Drow
Drudge
Dry Bones
Dry Goomba
Dryad
Duergar
Durga
Duvalia
Dwarf
Ebitan
Eidolon
Ekans
El Gigante
Eladrin
Eldar
Elder Gods
Electro-Koopa
Elemental
Elephant
Elf
Eliminator
Elite Pirate
Emperor Ing
Emperor of Mankind
Enderman
Endermite
Ermac
Ethereal
Ettercap
Ettin
Eveline
Evil Flower
Evolved Licker
Exploder
Eye Guy
FI-3 Neptune
Farfarello
Fargul Hatcher
Fast Headcrab
Fast Zombie
Fearow
Feeder
Felicia
Felldrake
Felljaw
Fenrir
Fire Piranha Plant
Firefly
Fission Metroid
Flamelurker
Fly
Flyer
Flytrap
Fomorian
Former
Foulspawn
Franken Bill
Frost Witches
Frostbite Spider
Fujin
Galeb duhr
Ganados
Gargantua
Gargantua Koopa Troopa
Gargoyle
Gargoyle Knight
Garrosh Hellscream
Gas Barge
Gelatinous cube
Gene Worm
Genie
Ghiozzo
Ghost
Ghoul
Giant
Giant Bat
Giant Leech
Giant Moth
Giant Whip Spider
Gibbering mouther
Gibberling
Giga Bite
Gigas Shadow
Gilmore
Githyanki
Githzerai
Giygas
Glacius
Glasp
Glimmer
Globster
Gloomba
Gnarly Gnome
Gnezdo
Gnoll
Gnome
Goat
Goblin
Godzilla
Golem
Gonarch
Gonome
Goomba
Goomball
Goombeetle
Gorgon
Gorn
Goro
Grabber
Grand Goomba
Grave Digger
Gravelstoke Family
Gray Company
Green Zombie
Grell
Grendel
Grick
Griffon
Grimlock
Guardian
Gulp Worm
Gunker
Gyrm
Hag
Halfling
Hammer Bros.
Hangedman
Haos
Haraevor
Harbinger
Harken's Heart
Harpy
Harris
Harvester
Haunted
Havel the Rock
Headcrab
Heartless
Hellhound
Helmed horror
Henry J. Waternoose III
Hilda Hidalgo
Hive Mind
Hobgoblin
Hollow
Homunculus
Hook Horror
Hopper
Hopping Metroid
Horned Reaper
Horse
Hound
Hound of ill omen
Houndeye
Hulk
Human
Human-Reaper
Hunter
Hunter Elite
Hunter Ing
Hunter Kai
Hunter Metroid
Hunters
Husk
Hybrid Dragon
Hydra
Hyena
Hyper Goomba
Hypnos T-Type
Iblis
Iblis Biter
Iblis Golem
Iblis Taker
Iblis Worm
Ifrit
Illithid
Iluzija
Imp
Inevitable
Infected
Infected Adder
Infected Alligator
Infected Bat
Infected Crow
Infected Leech
Infected Moth
Infector
Ing
Inglet
Invisible
Invisible Haunted
Iron Circle
Iron Golem
Iron Maiden
Ironhead
Irregular Mutant
Ivan Ooze
Ivan T-Types
Ivy
Ivy+YX
Ivysaur
J'avo
Jabberwock S3
Jack Baker
Jack Krauser
Jack Norman
Jack O' Goomba
Jafar
Jake the Dog
Jataaka
Javier Hidalgo
Jedah Dohma
Jelzap
Jockey
Johnny
Jon Talbain
Jumping Maneater
Kageo
Kakuna
Kamacuras
Kan-Ra
Kantus
Karn
Keeper
Kenfis
Kia
Kihunter
Killer Bee
Killer Plant
King Boom Boo
King Bulblin
King Ghidorah
King Kong
King Sphinx
King Vendrick
King Worm
Kintaro
Kipepeo
Kir-Lanan
Klixen
Kobold
Kog'Maw
Koopa
Koopa Kid
Koopa Paratroopa
Koopa Troopa
Koopalings
Koopatrol
Koopeleon
Kotal Kahn
Kraid
Kruthik
Kryll
Kumonga
Kuo-toa
Kytinn
Lakitu
Lamarr
Lambent
Lambent Berserker
Lambent Brumak
Lambent Drone
Lambent Leviathan
Lambent Polyp
Lambent Stalk
Lambent Wretch
Lamia
Large Body
Larry Koopa
Larva mage
Las Plagas
Last Giant
Laura Victoriano
Lavos
Leaper
Leechmonger
Lemmy Koopa
Leonardo
Lepotitsa
Leviathan
Librarian
Lich
Licker
Licker β
Lion
Lisa Trevor
Little Rex
Liu Kang
Lizard
Lizardfolk
Locust
Locust Berserker
Locust Boomer
Locust Drone
Locust Rager
Lonesome Gavlan
Lord Fuse
Lord Zedd
Ludwig von Koopa
Lurker
Lycanthrope
MA-121 Hunter "α"
MA-121 Hunter "β"
MA-124 Hunter "γ"
MA-125 Hunter-R
Mages of Saruun
Magikoopa
Magma beast
Majini
Malacoda
Malaugrym
Malthael
Mangler
Manticore
Marauder
Marguerite Baker
Marlboro
Master of the Valley
Meat
Medusa
Mega Bite
Mega-Shadow
Mephiles the Dark
Mesets
Metapod
Metroid
Metroid Hatcher
Metroid Prime
Michelangelo
Micro-Goomba
Mighty Minotaur
Mileena
Mimic
Minotaur
Mochtroid
Molded
Moloch
Moody
Moogle
Mooncalf
Mordrin
Moroi
Morpheus D. Duvall
Morton Koopa Jr.
Motaro
Mothra
Mummy
Muncher
Muton
Myrrah
NE-α Type
NE-β Type
Naga
Nail
Nali
Napad
Nautilus
Ndesu
Necromorph
Neil Fisher
Nemacyst
Nemacyte
Nemesis T-Type
Neoshadow
Nest
Nexus
Nidoking
Nidoqueen
Nidoran ♀
Nidoran ♂
Nidorina
Nidorino
Nightmare
Nightshade
Nihilanth
Nipper Plant
Nitara
Noob Saibot
Nosferatu
Novistador
Nyx
Octorok
Ogre
Ogroman
Old Iron King
Omega Pirate
Onaga
One Being
Oni
Ooze
Orc
Orcus
Order of Blue Fire
Orin
Orochi Hellbeast
Orthrus
Osh-Tekk
Osmund Saddler
Otyugh
Owlbear
Panthera
Paragoomba
Peashooter
Pedro Fernandez
Penanggalan
Peryton
Phaaze
Phane
Phantom Brigade
Phaz-Ing
Phazon Elite
Phazon Metroid
Pidgeot
Pidgeotto
Pidgey
Piers Nivans
Pikachu
Piranha Plant
Piranhacus Giganticus
Plague Crawler
Plant 42
Plant creatures
Pluto
Pod
Poison Headcrab
Poison Zombie
Pokémon
Pom-Pom
Popokarimu
Possessor
Praetorian
Pregnant
Protoss
Ptooie
Puker
Purple worm
Pyramid Head
Pyron
Quan Chi
Queen Leech
Quickling
RAAM
Rachel Foley
Rachni
Rachni Brood Warrior
Rachni Queen
Rachni Soldier
Rachni Worker
Ragewind
Raichu
Raiden
Rakk
Rakshasa
Ramon Salazar
Randall Boggs
Raphael
Rasklapanje
Rat
Raticate
Rattata
Ravager
Raven
Raven Roost Bandits
Reaper
Reapers
Reaver
Regenerador
Regenerator
Reptile
Reptilicus
Reptilicus Hunter
Revenant
Rhinoceros
Ricardo Irving
Ridley
Riftworm
Rikuo
Riptor
River Rats
Roc
Rock Worm
Rodan
Roper
Rot Harbinger
Rotten
Roy Curien
Rubin
Rust monster
SCP-049
SCP-066
SCP-087
SCP-087-1
SCP-106
SCP-682
SCP-966
Sahuagin
Salamander
Sam
Samson
Sandshrew
Sandslash
Sandworm
Sareena
Sarlacc
Satyr
Saurian
Savage Locust
Scagdead
Scarmiglione
Scathebeast
Scion
Scissor Tail
Scorpion
Scroll Mummy
Scythid
Sea Creeper
Sectoid
Seeder
Serapede
Sergei Vladimir
Shadar-kai
Shade
Shadow
Shadow Pirate
Shadow Sora
Shambling mound
Shang Tsung
Shao Kahn
Shar
Shardsoul
Shark
Sharn
Sheeva
Shibboleth
Shinnok
Shokan
Shriekbat
Shrieker
Siegebeast
Simon
Sin
Sire
Skaarj
Skeleton
Skorge
Skull Lord
Slaad
Slasher
Slender Man
Sliding Worm
Slime
Slimer
Slinger
Slug
Smoker
Snake
Snark
Snow Golem
Snowbeast
Solaris
Soldier
Sorrowsworn
Sovereign
Space Pirate Aerotrooper
Space Pirate Beam Trooper
Space Pirate Commander
Space Pirate Commando
Space Pirate Grenadier
Space Pirate Militia
Space Pirate Trooper
Space Pirates
Spearow
Species 8472
Specimen 2
Spectre
Sphinx
Spider
Spinal
Spiny
Spitter
Splasher
Splinter
Sploder
Spotlight
Squirtle
Stalker
Steve Burnside
Stinger
Stirge
Stone Guardian
Strelats
Suitors
Suspended
Swarm
Swarmer
Sweeper
Swordwing
T-A.L.O.S.
TaiGore
Tail Goomba
Tallon Metroid
Tank
Tarkata
Tarrasque
Taven
Teenage Mutant Ninja Turtles
Tempest
Tentacle
Tentacled Torment
Terror Dog
Thaalud
Thanatos T-Type
Thardus
The Bloat
The Pack
Theron Guard
Thin Man
Thorian
Thorian Creeper
Thresher Maw
Ticker
Tiefling
Titan
Tonberry
Tormentor
Torture Barge
Treant
Treeguard
Trico
Tripod
Troglodyte
Troll
Twig Blight
Twitcher
Tyranid
Tyrant
Tyrant T-001
Tyrant T-002
Tyrant T-091
Tyrant T-103
U-3
U-8
Ubermorph
Ubistvo
Umber hulk
Undead
Undead Dragon
Under Taker
Unfreezable Metroid
Unggoy
Unicorn
Uroboros Aheri
Uroboros Mkono
Uroboros Test Subject
Ustanak
Valtiel
Vampire
Vampiric Mist
Varren
Venusaur
Verdugo
Veserab
Vine Horror
Vortigaunt
Vulcan Blubber
Wall Blister
Warforged
Warlock
Warrior Ing
Wartortle
Waster
Watcher
Weapon
Web Spinner
Weedle
Werehog
Wheezer
Whopper
Wight
William Birkin
Witch
Wolf
Wolf Runners
Worg
Worker Splinter
World of Eberron
Wraith
Wretch
Wyvern
X Parasite
Xen Controller
Xen Grunt
Xen Ichthyosaur
Xen Tentacle
Xenomorph
Xenomorph Queen
Yautja
Yawn
Yoshi
Yuan-ti
Yukimi Botamon
Zairtail
Zebesian
Zerg
Zerimon
Zhentarim
Zombie
Zombie dog
Zombies
Zombine
Zoomer
natello
""".split('\n')

BANNED = """
anal
anus
arse
ass
ballsack
balls
bastard
bitch
biatch
bloody
blowjob
blow job
bollock
bollok
boner
boob
bugger
bum
butt
buttplug
clit
clitoris
cock
coon
crap
cunt
damn
dick
dildo
dyke
fag
feck
fellate
fellatio
felching
fuck
f u c k
fudgepacker
fudge packer
flange
Goddamn
God damn
hell
homo
jerk
jizz
knobend
knob end
labia
lmao
lmfao
muff
nigger
nigga
omg
penis
piss
poop
prick
pube
pussy
queer
scrotum
sex
shit
s hit
sh1t
slut
smegma
spunk
tit
tosser
turd
twat
vagina
wank
whore
wtf
""".split('\n')

class NameGenerator(object):
  def __init__(self, game, shortest=3, longest=100):
    self.game = game
    self.table = self.make_markov_table(self.sanitize(MONSTERS))
    self.shortest = shortest
    self.longest = longest

  def sanitize(self, lines):
    monsters = []
    for line in lines:
      line = line.lower()
      line = "".join(ch for ch in line if ch == " " or ch.isalpha())
      if len(line) > 2:
        monsters.append(line)
    return set(monsters)

  def make_markov_table(self, monsters):
    table = {}
    letters = set()
    for monster in monsters:
      letters.update(monster)
    for letter in letters:
      table[letter] = {}
    table["START"] = {}
    for monster in monsters:
      current = "START"
      for letter in monster:
        table[current][letter] = table[current].get(letter, 0) + 1
        current = letter
      table[current]["END"] = table[current].get("END", 0) + 1
    return table

  def valid_name(self, name):
    if len(name) < self.shortest: return False
    if len(name) > self.longest: return False
    lower_name = set(x.lower() for x in name)
    for word in BANNED:
      if word in lower_name:
        return False
    return True

  def generate_name(self):
    # Hacky and inefficient. TODO, maybe
    name = []
    current = "START"
    while current != "END":
      entry = self.table[current]
      next_letter = None
      total = 0
      for candidate in entry:
        count = entry[candidate]
        total += count
        if self.game.rng.randint(1, total) <= count:
          next_letter = candidate
      if next_letter == "END":
        if self.valid_name(name):
          return "".join(name).title()
        else:
          return self.generate_name()
      else:
        name.append(next_letter)
        current = next_letter
